// Default test task is used for code coverage only
test {
	useTestNG()
	ignoreFailures = true
}

// Custom test task for JAR testing
task testDeliverable(type: Test, group: 'verification') {
	useTestNG()
	// Print Java runtime version
	doFirst {
		println "${System.properties['java.runtime.version']} (${System.properties['java.runtime.name']})"
	}
	
	// Rearrange test classpath, add compiled JAR instead of main classes
	classpath = sourceSets.test.output + configurations.testRuntimeClasspath + files(jar.archiveFile)
	
	// Turn off jacoco
	/*jacoco {
		enabled = false
	}*/
	
	// Setup logging
	testLogging {
		exceptionFormat "full"
		events "skipped", "failed"
	}
}

// Setup jacoco task
// It should depend on 'test' task and reports should be generated in XML format, which is required by coveralls task
jacocoTestReport {
	//dependsOn test
	reports {
		xml.enabled = true
    }
}

/*coveralls {
	sourceDirs = files(sourceSets.main.java.srcDirs).files.absolutePath
}*/